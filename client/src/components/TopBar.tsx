import React from "react";\nimport { useQuery } from "@tanstack/react-query";\nimport { useGame } from "@/contexts/GameContext";\nimport { apiRequest } from "@/lib/queryClient";\nimport { User } from "lucide-react";\n\ninterface TopBarProps {\n  onOpenCharacterGallery: () => void;\n}\n\nexport function TopBar({ onOpenCharacterGallery }: TopBarProps) {\n  const { state } = useGame();\n  \n  // Fetch player data for username\n  const { data: player } = useQuery({\n    queryKey: ['/api/player/me'],\n    queryFn: async () => (await (await apiRequest('GET', '/api/player/me')).json()),\n    staleTime: 15000\n  });\n\n  // Fetch current character data\n  const { data: currentCharacter } = useQuery({\n    queryKey: ['/api/characters', state?.selectedCharacterId],\n    queryFn: async () => {\n      if (!state?.selectedCharacterId) return null;\n      const response = await apiRequest('GET', `/api/characters/${state.selectedCharacterId}`);\n      return await response.json();\n    },\n    enabled: !!state?.selectedCharacterId,\n  });\n\n  const getCharacterImage = () => {\n    if (state?.displayImage) return state.displayImage;\n    if (currentCharacter?.defaultImage) return currentCharacter.defaultImage;\n    return null;\n  };\n\n  return (\n    <header className=\"sticky top-0 z-40 w-full bg-gradient-to-r from-gray-900/95 via-purple-900/90 to-gray-900/95 backdrop-blur supports-[backdrop-filter]:bg-black/60 border-b border-purple-500/20\">\n      <div className=\"mx-auto max-w-5xl px-4 py-3 flex items-center justify-between\">\n        \n        {/* Left: Avatar + Username/Level */}\n        <div className=\"flex items-center gap-3\">\n          <div \n            className=\"relative cursor-pointer group\"\n            onClick={onOpenCharacterGallery}\n          >\n            <div className=\"w-12 h-12 rounded-lg bg-gradient-to-br from-purple-600/40 via-pink-600/40 to-purple-800/60 border border-purple-400/50 flex items-center justify-center overflow-hidden transition-all group-hover:border-purple-300/70 group-hover:shadow-lg group-hover:shadow-purple-500/20\">\n              {getCharacterImage() ? (\n                <img\n                  src={getCharacterImage()!}\n                  alt={currentCharacter?.name || 'Character'}\n                  className=\"w-full h-full object-cover\"\n                  onError={(e) => {\n                    (e.target as HTMLImageElement).src = '/uploads/placeholder-avatar.jpg';\n                  }}\n                />\n              ) : (\n                <User className=\"w-6 h-6 text-purple-300\" />\n              )}\n            </div>\n            {/* Small camera icon overlay */}\n            <div className=\"absolute -bottom-1 -right-1 w-5 h-5 rounded-full bg-purple-600 border border-purple-400 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\">\n              <span className=\"text-xs text-white\">ðŸ‘¤</span>\n            </div>\n          </div>\n          \n          <div className=\"leading-tight\">\n            <div className=\"text-sm font-semibold text-white\">{player?.username || \"Player\"}</div>\n            <div className=\"text-xs text-purple-300 font-medium\">Level {state?.level || 1}</div>\n            {state?.isAdmin && (\n              <div className=\"text-[10px] text-green-400 font-semibold\">Admin</div>\n            )}\n          </div>\n        </div>\n\n        {/* Right: Stats Cards - Responsive Layout */}\n        <div className=\"flex items-center gap-2\">\n          \n          {/* LustPoints Card */}\n          <div className=\"px-3 py-2 rounded-lg bg-black/30 border border-purple-500/20 min-w-[90px]\">\n            <div className=\"text-[10px] text-purple-300 font-semibold tracking-wider\">LUST<span className=\"text-pink-400\">POINTS</span></div>\n            <div className=\"text-white text-sm font-bold tabular-nums leading-tight\">{Math.floor(state?.points || 0).toLocaleString()}</div>\n          </div>\n          \n          {/* Points Per Hour Card */}\n          <div className=\"px-3 py-2 rounded-lg bg-black/30 border border-purple-500/20 min-w-[80px]\">\n            <div className=\"text-[10px] text-purple-300 font-semibold tracking-wide\">LP/HR</div>\n            <div className=\"text-white text-sm font-bold tabular-nums leading-tight\">{Math.floor(state?.passiveIncomeRate || 0).toLocaleString()}</div>\n          </div>\n          \n          {/* Energy Card */}\n          <div className=\"px-3 py-2 rounded-lg bg-black/30 border border-yellow-500/20 min-w-[75px]\">\n            <div className=\"text-[10px] text-yellow-300 font-semibold tracking-wide\">ENERGY</div>\n            <div className=\"text-white text-sm font-bold tabular-nums leading-tight\">{state?.energy || 0}/{state?.maxEnergy || 1000}</div>\n            <div className=\"text-[9px] text-yellow-400 leading-none\">+{state?.energyRegenRate || 1}/s</div>\n          </div>\n          \n        </div>\n      </div>\n    </header>\n  );\n}